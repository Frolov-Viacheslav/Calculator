#!groovy
// Ждет окончания предыдущей сборки (нельзя несколько одновременно)
properties([disableConcurrentBuilds()]) 
pipeline {
 agent { label 'slave01' }
 options {
   // Выводить в логе сборки время каждой операции
   timestamps() 
  }
  stages {
       stage('launch slave') {
      steps {
            build 'Ansible_master'
      }
    }
  }
  post { 
        // Выполняет в конце сборки (если сборка не удалась)
        failure { 
            sh '''
            if  [ -d HelloWorld ]; then
            rm -r HelloWorld
            fi
            git clone "git@github.com:Frolov-Viacheslav/HelloWorld.git" --branch dev
            cd HelloWorld
            git reset --hard HEAD~
            git push -f
            cd ..
            rm -r HelloWorld
            '''
        }
    }
}
